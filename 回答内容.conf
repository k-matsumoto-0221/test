ECSのログについて、以下の2つの観点を詳しく解説します：

1. コンテナのログ (rootプロセスのstdout/stderr)

概要

	•	コンテナ内で稼働するアプリケーションの標準出力（stdout）および標準エラー出力（stderr）のログ。
	•	主にアプリケーションの動作状況やエラーを確認するために使用されます。

各種どこから取れる？出る？

	•	取得元:
	•	コンテナ自体が生成する標準出力と標準エラー出力。
	•	ECSタスク定義で指定されたログドライバによってログが収集されます。
	•	ログドライバの例:
	1.	awslogs（推奨）:
	•	CloudWatch Logsにログを送信。
	2.	json-file:
	•	コンテナホスト上のJSONファイルにログを保存（デフォルト）。
	3.	splunk, fluentd, gelf:
	•	サードパーティのログ管理ツールに送信。

どこにどうやって集める？

	•	収集先:
	•	CloudWatch Logs:
	•	awslogsドライバを使用して、ログをCloudWatchに送信。
	•	S3:
	•	長期保存が必要な場合、CloudWatch LogsからS3にエクスポート。
	•	設定方法:
	1.	タスク定義でawslogsドライバを指定。

"logConfiguration": {
  "logDriver": "awslogs",
  "options": {
    "awslogs-group": "/ecs/my-app",
    "awslogs-region": "us-east-1",
    "awslogs-stream-prefix": "ecs"
  }
}


	2.	必要に応じてロググループの保持期間を設定。

保存期間は？

	•	CloudWatch Logs:
	•	デフォルト: 無期限。
	•	推奨: 30日～90日間保持後、S3にアーカイブ。
	•	S3:
	•	無期限保存が可能。ライフサイクルポリシーでアーカイブや削除を自動化。

保存のコストは？S3のストレージクラスには何を使う？

	•	CloudWatch Logs:
	•	保存コスト: $0.50/GB。
	•	クエリ実行（Logs Insights）: $0.005/GB。
	•	S3ストレージクラス:
	•	短期保存: S3 Standard。
	•	長期保存: S3 Glacier（$0.004/GB）。

2. ECS自体から取得できるログ

概要

	•	ECSエージェントやクラスターの動作状況に関するログ。
	•	主に、ECSクラスター、タスク、サービスの管理状況やデバッグ情報を確認するために使用。

各種どこから取れる？出る？

	•	取得元:
	1.	ECSエージェントログ:
	•	ECSコンテナインスタンス上で稼働するエージェントが生成するログ。
	•	デバッグ情報やタスクスケジューリングの問題を追跡。
	•	場所:
	•	Amazon Linux 2: /var/log/ecs/ecs-agent.log.*
	2.	ECSデバッグログ:
	•	ECSクラスター全体の状態を追跡。
	•	CloudTrailやEventBridgeイベントも含め、クラスター操作履歴を確認可能。

どこにどうやって集める？

	•	収集先:
	1.	CloudWatch Logs:
	•	ECSエージェントログをCloudWatch Logsに送信。
	•	デフォルトではインスタンス上に保存されるが、CloudWatch Agentを使用して収集。
	2.	S3:
	•	ECSエージェントログやクラスター操作ログを長期保存する場合にエクスポート。
	3.	AWS CloudTrail:
	•	ECSのAPI操作ログを記録し、アクションの履歴を追跡可能。
	•	設定方法:
	1.	ECSエージェントログをCloudWatch Logsに送信:
	•	/etc/ecs/ecs.configでログ設定を有効化。

ECS_LOGLEVEL=debug
ECS_LOGFILE=/var/log/ecs/ecs-agent.log


	•	CloudWatch Agentをインストールしてログを送信。

	2.	クラスター操作ログをCloudTrailで取得:
	•	CloudTrailを有効化してECS API操作ログを記録。

保存期間は？

	•	CloudWatch Logs:
	•	デフォルト: 無期限。
	•	推奨: 90日間保持後、S3にエクスポート。
	•	CloudTrail:
	•	デフォルト: 90日間。
	•	S3に保存することで無期限に保持可能。

保存のコストは？S3のストレージクラスには何を使う？

	•	CloudWatch Logs:
	•	保存コスト: $0.50/GB。
	•	CloudTrail:
	•	記録コスト: $2.00/100,000イベント。
	•	S3ストレージクラス:
	•	短期保存: S3 Standard。
	•	長期保存: S3 Standard-IAまたはS3 Glacier。

まとめ

観点	コンテナログ（stdout/stderr）	ECS自体のログ
取得元	コンテナの標準出力、標準エラー出力	ECSエージェントログ、CloudTrail
収集先	CloudWatch Logs、S3	CloudWatch Logs、S3、CloudTrail
保存期間	CloudWatch: 無期限（推奨: 30~90日）	CloudWatch: 無期限（推奨: 90日）
保存コスト	CloudWatch: $0.50/GB	CloudWatch: $0.50/GB、CloudTrail: $2/100K
S3ストレージクラス	短期: Standard長期: Glacier	短期: Standard長期: Glacier

この設定により、ECS環境でのコンテナおよびクラスター管理のログを効率的に収集・保存できます。